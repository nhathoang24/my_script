// ==UserScript==
// @name        ABPVN AdsBlock
// @namespace   ABPVN
// @author      ABPVN
// @copyright   ABPVN
// @homepage    https://abpvn.com
// @supportURL  https://github.com/abpvn/abpvn/issues
// @icon        https://abpvn.com/icon.png
// @description Script block ads, remove wating of ABPVN
// @description:vi Script ch·∫∑n qu·∫£ng c√°o,lo·∫°i b·ªè ch·ªù ƒë·ª£i c·ªßa ABPVN
// @contributionURL https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=donghoang.nguyen@gmail.com&item_name=ABPVN Donation
// @grant       GM_getValue
// @grant       GM_setValue
// @grant       GM_openInTab
// @grant       GM_registerMenuCommand
// @include     http://*
// @include     https://*
// @version ¬† ¬† 2.3.26
// @change-log  Fix code scanning
// @run-at      document-end
// @downloadURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/ABPVN20AdsBlock.user.js
// @updateURL https://raw.githubusercontent.com/FiorenMas/Userscripts/release/release/ABPVN20AdsBlock.meta.js
// ==/UserScript==
String.prototype.startWith=function(t){return"function"==typeof this.indexOf&&0===this.indexOf(t)},String.prototype.ismatch=function(t){return"function"==typeof this.match&&null!==this.match(t)};var byPass={hideLinkUnlock:function(){var t=document.querySelectorAll(".onp-sl-content,.onp-locker-call,[data-locker-id]");if(t.length){if(ABPVN.cTitle(),!document.getElementById("abpvn_style")){var e=document.createElement("style");e.id="abpvn_style",e.innerHTML=".onp-sl-content{display:block!important;}.onp-sl,.onp-sl-overlap-box{display:none!important;}.onp-sl-blur-area{filter: none!important;}",document.body.appendChild(e)}for(var n in t){if(t[n].firstChild&&"Unlocked by ABPVN.COM"!=t[n].firstChild.innerText){var o=document.createElement("div");o.innerHTML='<a href="http://abpvn.com" target="_blank" style="color: #08BE54;font-weight: bold;">Unlocked by ABPVN.COM</a>',o.style.textAlign="right",t[n].insertBefore(o,t[n].firstChild)}t[n].style&&(t[n].style.display="block")}var i=document.querySelectorAll('.onp-sl,div[id^="content-locker"]');for(var r in i)i[r].style&&(i[r].style.display="none !important",i[r].setAttribute("hidden","hidden"))}},removeShortLink:function(){var t=document.querySelectorAll('a[href*="/full/?api="]'),e=0;if(t.length){ABPVN.cTitle();for(var n=0;n<t.length;n++){var o=t[n],i=o.getAttribute("href").match(/url=(.+?)&|$/);if(i[1]){o.setAttribute("href",atob(i[1].replace(/=+$/,"")));var r=o.getAttribute("title");o.setAttribute("title",r?r+" ":"Short link by pass by ABPVN.COM"),e++}}Logger.info("By pass "+e+" short link")}},showBodyLinkByPassAndRedirect:function(t){document.body.innerHTML="<style>html,body{background: #fff !important;}h1{color: #00dc58;}a{color: #015199}a h1{color: #015199;}</style><center><h1>ABPVN quick bypass ƒë√£ ho·∫°t ƒë·ªông</h1><a href='https://abpvn.com/donate'><h1>·ª¶ng h·ªô ABPVN</h1></a><br/>Kh√¥ng t·ª± chuy·ªÉn trang? <a href='"+t+"' title='Chuy·ªÉn trang'>Click v√†o ƒë√¢y</a></center>",setTimeout((()=>location.href=t),500)},quickByPassLink:function(){var t=/share4you.pro|derow.win/;if(/123link\..*|phlame.pw|megaurl\.*|www.123l\.*|vinaurl\.*|share4you.pro|doxeaz10.site|derow.win|linkviet.net|ez4linkss.com|ckk.ai|link\.codevn\.net|linksht.com|beta.shortearn.eu|getlink\.tienichmaytinh\.net|download.baominh.tech|download3s.net/.test(location.hostname))try{var e,n=new MutationObserver((t=>{t.forEach((t=>{(function(t){return"disabled"===t.attributeName&&!t.target.disabled||"class"===t.attributeName&&!t.target.classList.contains("disabled")})(t)&&t.target.click(),"href"===t.attributeName&&(e=t.target.getAttribute("href"),this.showBodyLinkByPassAndRedirect(e))}))})),o={attributes:!0},i=document.getElementById("invisibleCaptchaShortlink")||document.querySelector(".download_1");if(i)n.observe(i,o);else if(document.querySelector("#originalLink"))e=document.querySelector("#originalLink").getAttribute("href"),this.showBodyLinkByPassAndRedirect(e);else{var r=document.querySelector(".get-link"),a=t.test(location.hostname)?6e3:100;r&&(n.observe(r,o),/megaurl\.*|vinaurl\.*|doxeaz10.site|linkviet.net|ez4linkss.com|ckk.ai|link\.codevn\.net|beta.shortearn.eu|getlink\.tienichmaytinh\.net|download.baominh.tech|download3s.net/.test(location.hostname)||setTimeout((function(){$("#go-link").addClass("go-link").trigger("submit.adLinkFly.counterSubmit").one("submit.adLinkFly.counterSubmit",(function(e){e.preventDefault(),t.test(location.hostname)||location.reload()}))}),a))}}catch(t){Logger.error(t)}},wikiall_org:function(){if("wikiall.org"==location.hostname&&document.querySelector("#timer")){var t=new MutationObserver((t=>{t.forEach((t=>{if("childList"==t.type){var e=t.target.querySelector("a");this.showBodyLinkByPassAndRedirect(e.getAttribute("href"))}}))})),e=document.querySelector("#place");t.observe(e,{childList:!0})}},link1s_com:function(){window.addEventListener("DOMContentLoaded",(()=>{let t=document.querySelector("a#link1s");if(t&&t.getAttribute("href").match(/http?s:\/\//)){Logger.info("Link1s.com step 1 match");let e=t.getAttribute("href");this.showBodyLinkByPassAndRedirect(e)}else{if(document.querySelector("#link1s-snp .btn-primary")){Logger.info("Link1s.com step 2 match"),Logger.info("Finding next url");let t=[...document.querySelectorAll("script")].map((t=>t.innerText)).join("\n").match(/link1sLink\s=\s\'(.+)\';/);if(t&&t[1])return void this.showBodyLinkByPassAndRedirect(t[1])}var e=new MutationObserver((t=>{t.forEach((t=>{"href"===t.attributeName&&(link=t.target.getAttribute("href"),this.showBodyLinkByPassAndRedirect(link))}))}));"link1s.com"===location.hostname&&(document.querySelector(".get-link")||document.querySelector(".skip-ad"))&&(Logger.info("Link1s.com step 3 match"),e.observe(document.querySelector(".get-link")||document.querySelector(".skip-ad"),{attributes:!0,subtree:!0}))}}))},init:function(){configure.getValue("unlock_content",!0)&&(window.addEventListener("DOMContentLoaded",this.hideLinkUnlock),window.addEventListener("load",this.hideLinkUnlock),this.hideLinkUnlock()),configure.getValue("remove_short_link",!0)&&window.addEventListener("DOMContentLoaded",this.removeShortLink),configure.getValue("quick_by_pass_link",!0)&&(this.quickByPassLink(),this.wikiall_org(),this.link1s_com())}},Logger={style:"color: #00DC58",info:function(t){console.info("%cABPVN.COM Info: ",this.style,t)},warn:function(t){console.warn("%cABPVN Warn: ",this.style,t)},error:function(t){console.error("%cABPVN Error: ",this.style,t)},log:function(t){console.log("%cABPVN Log: ",this.style,t)}},getLink={showBodyLinkDownloadAndRedirect:function(t,e){document.body.innerHTML="<style>html,body{background: #fff !important;}h1{color: #00dc58;}a{color: #015199}a h1{color: #015199;}</style><center><h1>ABPVN "+t+" download ƒë√£ ho·∫°t ƒë·ªông</h1><a href='https://abpvn.com/donate'><h1>·ª¶ng h·ªô ABPVN</h1></a><br/>Kh√¥ng t·ª± t·∫£i xu·ªëng? <a href='"+e+"' title='Download'>Click v√†o ƒë√¢y</a></center>",location.href=e},mediafire_com:function(){if(this.url.startWith("http://www.mediafire.com/file/")||this.url.startWith("https://www.mediafire.com/file/")){var t=document.querySelector(".download_link a.input").getAttribute("href");t.startWith("http")&&this.showBodyLinkDownloadAndRedirect("MediaFire",t)}},init:function(){this.url=location.href,configure.getValue("quick_download",!0)&&this.mediafire_com()}},fixSite={elementExist:function(t){return null!=document.querySelector(t)},getAllText:function(t){var e="",n=document.querySelectorAll(t);if(n)for(var o in n)n[o].innerText&&(e+=n[o].innerText);return e},getScript:function(t){var e=new XMLHttpRequest;e.open("GET",t),e.addEventListener("load",(function(t){var n=new Blob([e.responseText],{type:"text/javascript"}),o=URL.createObjectURL(n),i=document.createElement("script");i.src=o,i.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(i)})),e.send()},loadCss:function(t,e){var n=document.createElement("link");n.rel="stylesheet",n.id=e,n.href=t,document.getElementsByTagName("head")[0].appendChild(n)},antiAdblockRemover:function(){try{var t="By pass adBlock detect r·ªìi nh√©! Hahahahaha üòÅüòÅüòÅ";"function"==typeof adBlockDetected&&(adBlockDetected=function(){Logger.info(t)}),"function"==typeof showAdsBlock&&(showAdsBlock=function(){Logger.info(t)}),"function"==typeof nothingCanStopMeShowThisMessage&&(nothingCanStopMeShowThisMessage=function(){Logger.info(t)})}catch(t){Logger.error(t)}},topphimhd_info:function(){if(this.url.startWith("http://lb.topphimhd.info")){var t=document.querySelector('[data-ads=""]');t&&(t.remove(),Logger.log("Removed ads source"),ABPVN.cTitle())}},luotphim:function(){if(this.url.startWith("https://luotphim.top/xem-phim")||this.url.startWith("https://luotphim.top/phim-")||this.url.startWith("https://luotphim.fun/xem-phim")||this.url.startWith("https://luotphim.fun/phim-"))var t=1,e=setInterval((()=>{document.querySelector(".btn-close-preroll")&&"none"!=document.querySelector("#fakeplayer").style.display?(Logger.log("Click to by pass preroll: "+t),t++,document.querySelector(".btn-close-preroll").click()):(clearInterval(e),Logger.log("By passed preroll"))}),100)},ios_codevn_net:function(){if(this.url.match(/ios\.codevn\.net/)){const t=document.createElement("style");t.innerHTML='div[id*="ScriptRoot"]{height: 1px !important;}',document.head.appendChild(t),ABPVN.cTitle()}},saostar_vn:function(){if(this.url.startWith("https://www.saostar.vn/")){const t=document.createElement("style");t.innerHTML="header.bg-white {margin-top: 0 !important}.layout.pt-mobi-top {padding-top: 0 !important}",document.head.appendChild(t),ABPVN.cTitle()}},mephimtv_cc:function(){this.url.startWith("https://mephimtv.cc")&&(ABPVN.cTitle(),setTimeout((()=>document.body.classList.remove("compensate-for-scrollbar")),100))},linkneverdie_net:function(){if(this.url.startWith("https://linkneverdie.net")){const t=$.prototype.html;$.prototype.html=function(arguments){if("body"===this.selector&&(""===arguments||arguments.includes("huong-dan")))return ABPVN.cTitle(),void Logger.info("üòÅüòÅAnti Adblock √†? C√≤n l√¢u nh√©!");t.call(this,arguments)}}},redirect_dafontvn_com(){this.url.startWith("https://redirect.dafontvn.com")&&(ABPVN.cTitle(),window.addEventListener("load",(()=>{var t=aesCrypto.decrypt(convertstr($.urlParam("o")),convertstr("root"));location.href=t})))},removeRedir:function(t){if(this.url.match(new RegExp(t.url,"g"))||this.url.startWith(t.url)){ABPVN.cTitle();var e=document.querySelectorAll(t.selector||'a[href^="'+t.replace+'"]');Logger.info("Remove Redirect for "+e.length+" links"),e.length&&e.forEach(function(e){for(var n=e.getAttribute("href").replace(t.replace,""),o=0;n.indexOf("%2")>-1&&o<5;)n=decodeURIComponent(n),o++;for(o=0;0===n.indexOf("aHR0c")&&o<5;)n=atob(n),o++;e.setAttribute("href",n),e.setAttribute("title","Link ƒë√£ x√≥a chuy·ªÉn h∆∞·ªõng trung gian b·ªüi abpvn.com")}.bind(this))}},removeRedirect(){[{url:"https://samsungvn.com",replace:"https://samsungvn.com/xfa-interstitial/redirect?url="},{url:"https://forum.vietdesigner.net",replace:"redirect/?url="},{url:"www.webtretho.com/forum/",replace:/http(s?):\/\/webtretho\.com\/forum\/links\.php\?url=/,selector:'a[href*="webtretho.com/forum/links.php?url="]'},{url:"https://tuong.me/",replace:"https://tuong.me/chuyen-huong/?url="},{url:"https://yhocdata.com/",replace:"https://yhocdata.com/redirect/?url="},{url:"https://vn-z.vn/",replace:"https://vn-z.vn/redirect?to="},{url:"https://romgoc.net",replace:"https://romgoc.net/redirect-to/?url="},{url:"https://tophanmem.com",replace:"https://tophanmem.com/redirect-to/?url="},{url:"https://anonyviet.com",replace:"https://anonyviet.com/tieptucdidentrangmoi/?url="},{url:"https://icongnghe.com",replace:"https://icongnghe.com/download/?url="},{url:"https://cakhia-tv.onl",replace:"/chuyen-huong/?redirect="}].forEach(function(t){this.removeRedir(t)}.bind(this))},init:function(){this.url=location.href,configure.getValue("remove_redirect",!0)&&this.removeRedirect(),this.antiAdblockRemover(),this.topphimhd_info(),this.luotphim(),this.ios_codevn_net(),this.saostar_vn(),this.mephimtv_cc(),this.redirect_dafontvn_com()}},adBlocker={mgIdAdRemover:function(){if(!/ios\.codevn\.net/.test(location.hostname)){var t=document.querySelectorAll('[id*="ScriptRoot"]');if(t&&t.length){ABPVN.cTitle(),Logger.log("Removed mgIdAd placeholder");for(var e=0;e<t.length;e++)"megaup.net"!==location.hostname&&(t[e].id="ScriptRoot-removed-by-abpvn-"+Math.random()),t[e].innerHTML=""}}},noAdsModal:function(){if(location.hostname.match(/vebo|90phut|khomuc|xoilac|banhkhuc/)){const t=document.createElement("style");t.innerHTML="html,body{overflow: auto!important} .modal-backdrop,.modal{display: none!important}",document.head.appendChild(t),ABPVN.cTitle()}},init:function(){this.url=location.href,this.mgIdAdRemover(),this.noAdsModal()}},configure={urls:{setting:"https://abpvn.com/script-setting.html",issue:"https://github.com/abpvn/abpvn/issues/new",fanpage:"https://www.facebook.com/abpvn.org"},openUrl:function(t){"function"==typeof GM_openInTab&&GM_openInTab(t)},getValue:function(t,e){var n;return"function"==typeof GM_getValue&&(n=GM_getValue(t)),void 0===n?e:n},setValue:function(t,e){if("function"==typeof GM_setValue)return GM_setValue(t,e)},setUpSetting:function(){if(this.url===this.urls.setting){var t=document.querySelector("#setting-container");if(t){t.classList.add("installed");var e=t.querySelectorAll('input[type="checkbox"]');e&&e.forEach((t=>{t.checked=this.getValue(t.name,!0),t.addEventListener("change",(t=>{var e=t.target.name;this.setValue(e,t.target.checked)}))}))}}},init:function(){this.url=location.href,"function"==typeof GM_registerMenuCommand&&(GM_registerMenuCommand("ABPVN - C√†i ƒë·∫∑t",(()=>{this.openUrl(this.urls.setting)})),GM_registerMenuCommand("ABPVN - B√°o l·ªói",(()=>{this.openUrl(this.urls.issue)})),GM_registerMenuCommand("ABPVN - Fanpage",(()=>{this.openUrl(this.urls.fanpage)}))),this.setUpSetting()}},ABPVN={cTitle:function(){-1===document.title.indexOf(" - Fixed by ABPVN.COM")&&(document.title=document.title+" - Fixed by ABPVN.COM")},init:function(){adBlocker.init(),getLink.init(),fixSite.init(),byPass.init(),window===window.parent&&configure.init()}};ABPVN.init();